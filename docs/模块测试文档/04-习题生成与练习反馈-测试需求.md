# 习题生成与练习反馈 - 测试需求文档

## 1. 测试范围概述

本文档针对「习题生成与练习反馈」模块进行单元测试设计，涵盖以下子模块：

- 习题生成模块
- 判题与反馈模块
- 失败处理与降级模块

---

## 2. 基础测试数据

### 2.1 测试用知识点数据

#### 正常知识点数据（有效输入）

| 数据类型 | 用途 | 预期内容特征 |
|----------|------|--------------|
| 概念定义型 KP | 选择题/填空题测试 | 包含术语定义、核心概念描述 |
| 步骤过程型 KP | 简答题/填空题测试 | 包含操作步骤、流程说明 |
| 多证据片段 KP | 依据引用测试 | 包含多个原文片段绑定 |

#### 知识点数据结构示例

```yaml
knowledge_point:
  kp_id: "kp_001"
  title: "智能体（Agent）的定义"
  learning_content:
    summary:
      definition: "智能体是一个能够感知环境并采取行动的系统"
      key_points:
        - "感知环境"
        - "自主决策"
        - "执行行动"
    levels: []
  evidence_snippets:
    - snippet_id: "sn_001"
      content: "智能体（Agent）是指能够感知环境..."
      source_path: "chapter01.md"
      line_range: [10, 15]
    - snippet_id: "sn_002"
      content: "现代AI智能体通常具备..."
      source_path: "chapter01.md"
      line_range: [20, 25]
```

### 2.2 测试用例模板数据结构

#### 选择题模板

```yaml
exercise:
  type: "choice"
  question: "关于智能体的描述，以下正确的是？"
  options:
    - id: "A"
      text: "只能被动响应指令"
      is_correct: false
    - id: "B"
      text: "能够感知环境并自主行动"
      is_correct: true
    - id: "C"
      text: "不需要任何计算资源"
      is_correct: false
    - id: "D"
      text: "只能用于游戏领域"
      is_correct: false
  evidence_snippet_ids: ["sn_001"]
  difficulty: "基础理解"
```

#### 填空题模板

```yaml
exercise:
  type: "fill_blank"
  question: "智能体的三大核心能力是：感知_____、自主_____、执行_____。"
  blanks:
    - expected: "环境"
      alternatives: ["周围环境", "外部环境"]
    - expected: "决策"
      alternatives: ["判断", "选择"]
    - expected: "行动"
      alternatives: ["动作", "执行"]
  evidence_snippet_ids: ["sn_001"]
  difficulty: "基础理解"
```

#### 简答题模板

```yaml
exercise:
  type: "short_answer"
  question: "请用自己的话解释什么是智能体，并列举其主要特征。"
  reference_points:
    - "能够感知环境变化"
    - "具备自主决策能力"
    - "可以执行相应行动"
    - "通常基于AI技术实现"
  evidence_snippet_ids: ["sn_001", "sn_002"]
  difficulty: "基础理解"
```

---

## 3. 测试用例

### 3.1 习题生成模块测试

#### TC-EXG-001: 生成单选题

| 项目 | 内容 |
|------|------|
| 前置条件 | 知识点包含概念定义类内容 |
| 输入 | KP 数据，包含学习内容摘要和证据片段 |
| 预期输出 | 1道选择题，包含题干、4个选项（1正确+3错误）、证据引用 |
| 验证点 | 题目格式正确性、选项数量、正确答案标记 |

#### TC-EXG-002: 生成多选题

| 项目 | 内容 |
|------|------|
| 前置条件 | 知识点内容支持多答案场景（如"智能体具备以下哪些能力"） |
| 输入 | KP 数据 |
| 预期输出 | 1道多选题，包含多个正确选项和干扰项 |
| 验证点 | 多正确答案标识、干扰项合理性 |

#### TC-EXG-003: 生成填空题

| 项目 | 内容 |
|------|------|
| 前置条件 | 知识点包含可提取的关键术语 |
| 输入 | KP 数据，包含步骤或定义类内容 |
| 预期输出 | 1道填空题，包含题干和空白处、参考答案列表 |
| 验证点 | 空白位置合理性、参考答案完整性 |

#### TC-EXG-004: 生成简答题

| 项目 | 内容 |
|------|------|
| 前置条件 | 知识点内容丰富，可提取多个要点 |
| 输入 | KP 数据，包含3个以上关键点 |
| 预期输出 | 1道简答题，包含题干和参考评分要点 |
| 验证点 | 问题开放性、参考要点覆盖度 |

#### TC-EXG-005: 生成混合题型

| 项目 | 内容 |
|------|------|
| 前置条件 | 知识点内容同时支持多种题型 |
| 输入 | 请求生成3道题，包含多种题型 |
| 预期输出 | 3道题，题型分布合理（如1选择+1填空+1简答） |
| 验证点 | 题型多样性、题目数量正确 |

#### TC-EXG-006: 题目数量限制（1~3题）

| 项目 | 内容 |
|------|------|
| 前置条件 | 知识点内容丰富 |
| 输入 | 请求生成2道题 |
| 预期输出 | 恰好返回2道题 |
| 验证点 | 数量控制准确性 |

#### TC-EXG-007: 证据片段引用保留

| 项目 | 内容 |
|------|------|
| 前置条件 | 知识点绑定多个原文片段 |
| 输入 | KP 数据，包含 `evidence_snippets` |
| 预期输出 | 每道题关联至少1个 `evidence_snippet_ids` |
| 验证点 | 引用完整性、可追溯性 |

#### TC-EXG-008: 干扰项合理性

| 项目 | 内容 |
|------|------|
| 前置条件 | 概念存在相近/易混淆术语 |
| 输入 | 概念定义类KP |
| 预期输出 | 选择题干扰项来自常见误区或相近概念 |
| 验证点 | 干扰项质量、非明显错误 |

---

### 3.2 判题与反馈模块测试

#### TC-GRF-001: 选择题正确判定 内容 |
|------

| 项目 ||------|
| 前置条件 | 已生成1道选择题 |
| 输入 | 用户选择正确答案 |
| 预期输出 | 反馈 `{ is_correct: true, feedback: "正确！" }` |
| 验证点 | 判题准确性、反馈及时性 |

#### TC-GRF-002: 选择题错误判定

| 项目 | 内容 |
|------|------|
| 前置条件 | 已生成1道选择题 |
| 输入 | 用户选择错误答案 |
| 预期输出 | 反馈 `{ is_correct: false, feedback: "错误。正确答案是..." }`，引用原文 |
| 验证点 | 错误反馈包含原因、原文引用正确性 |

#### TC-GRF-003: 填空题精确匹配

| 项目 | 内容 |
|------|------|
| 前置条件 | 已生成1道填空题 |
| 输入 | 用户答案与期望答案完全一致 |
| 预期输出 | 判定为正确 |
| 验证点 | 精确匹配逻辑 |

#### TC-GRF-004: 填空题同义匹配

| 项目 | 内容 |
|------|------|
| 前置条件 | 填空题配置了同义答案列表 |
| 输入 | 用户输入期望答案的同义表达 |
| 预期输出 | 判定为正确，匹配度评分高 |
| 验证点 | 同义词识别、匹配度计算 |

#### TC-GRF-005: 填空题部分匹配

| 项目 | 内容 |
|------|------|
| 前置条件 | 多空填空题 |
| 输入 | 用户答案部分正确 |
| 预期输出 | 反馈各空匹配情况，给出参考答案 |
| 验证点 | 部分匹配反馈完整性 |

#### TC-GRF-006: 简答题要点覆盖反馈

| 项目 | 内容 |
|------|------|
| 前置条件 | 已生成1道简答题，包含5个参考要点 |
| 输入 | 用户答案覆盖部分要点 |
| 预期输出 | 反馈 `{ covered_points: [...], missing_points: [...] }` |
| 验证点 | 要点识别准确性、覆盖分析正确性 |

#### TC-GRF-007: 简答题完整回答反馈

| 项目 | 内容 |
|------|------|
| 前置条件 | 已生成1道简答题 |
| 输入 | 用户答案覆盖所有参考要点 |
| 预期输出 | 肯定反馈，标注所有要点均已覆盖 |
| 验证点 | 完整回答识别 |

#### TC-GRF-008: 原文对照反馈

| 项目 | 内容 |
|------|------|
| 前置条件 | 判题结果为错误/部分正确 |
| 输入 | 用户答案 |
| 预期输出 | 反馈包含原文片段引用（`source_path` + `line_range`） |
| 验证点 | 原文追溯功能 |

---

### 3.3 失败处理与降级模块测试

#### TC-FD-001: 出题失败降级

| 项目 | 内容 |
|------|------|
| 前置条件 | LLM 服务不可用或超时 |
| 输入 | 习题生成请求 |
| 预期输出 | 返回 `{ success: false, fallback: true, message: "暂无法生成练习" }` |
| 验证点 | 降级提示、异常捕获 |

#### TC-FD-002: 判题失败降级

| 项目 | 内容 |
|------|------|
| 前置条件 | LLM 服务不可用或判题超时 |
| 输入 | 答案提交请求 |
| 预期输出 | 返回参考答案/要点，不给对错判定 |
| 验证点 | 降级策略、参考答案提供 |

#### TC-FD-003: 空知识点的习题生成

| 项目 | 内容 |
|------|------|
| 前置条件 | 知识点无学习内容或证据片段 |
| 输入 | 习题生成请求 |
| 预期输出 | 返回失败提示或跳过此知识点 |
| 验证点 | 空数据防护 |

#### TC-FD-004: 超出题型范围处理

| 项目 | 内容 |
|------|------|
| 前置条件 | 请求不支持的题型 |
| 输入 | 指定题型参数（如 "判断题"） |
| 预期输出 | 返回错误或忽略不支持的题型 |
| 验证点 | 参数校验、边界处理 |

#### TC-FD-005: 网络重试与超时

| 项目 | 内容 |
|------|------|
| 前置条件 | LLM 服务短暂不可用 |
| 输入 | 习题生成请求 |
| 预期输出 | 重试后成功或最终失败并降级 |
| 验证点 | 重试机制、超时控制 |

---

### 3.4 集成测试用例

#### TC-INT-001: 完整练习流程

| 项目 | 内容 |
|------|------|
| 前置条件 | 知识点数据完整，包含学习内容和证据片段 |
| 输入 | 进入学习 -> 生成习题 -> 作答 -> 获取反馈 |
| 预期输出 | 完整流程完成，反馈准确 |
| 验证点 | 端到端流程正确性 |

#### TC-INT-002: 多知识点习题生成

| 项目 | 内容 |
|------|------|
| 前置条件 | 知识体系包含多个知识点 |
| 输入 | 批量生成多个KP的习题 |
| 预期输出 | 每个KP对应习题集，格式规范 |
| 验证点 | 批量处理、格式一致性 |

#### TC-INT-003: 习题与学习内容一致性

| 项目 | 内容 |
|------|------|
| 前置条件 | 知识点学习内容已生成 |
| 输入 | 基于该知识点生成习题 |
| 预期输出 | 题目内容与学习内容/原文一致 |
| 验证点 | 内容一致性、无矛盾 |

#### TC-INT-004: 反馈后原文跳转

| 项目 | 内容 |
|------|------|
| 前置条件 | 用户完成作答并获取反馈 |
| 输入 | 点击反馈中的原文引用 |
| 预期输出 | 定位到原文片段位置 |
| 验证点 | 原文跳转准确性 |

---

## 4. 测试数据文件命名规范

所有测试用数据文件应统一放置于：

```
/test_data/exercises/
├── normal/                    # 正常输入数据
│   ├── concept_kp.yaml        # 概念定义型知识点
│   ├── procedure_kp.yaml      # 步骤过程型知识点
│   └── multi_snippet_kp.yaml  # 多证据片段知识点
├── templates/                 # 题型模板
│   ├── choice_template.yaml
│   ├── fill_blank_template.yaml
│   └── short_answer_template.yaml
├── user_answers/              # 用户答案样本
│   ├── correct_choice.json
│   ├── wrong_choice.json
│   ├── correct_fill_blank.json
│   └── partial_short_answer.json
└── expected_feedback/         # 期望反馈结果
    ├── correct_feedback.json
    └── wrong_feedback.json
```

---

## 5. 测试执行优先级

| 优先级 | 测试类型 | 说明 |
|--------|----------|------|
| P0 | 核心路径测试 | TC-EXG-001、TC-GRF-001、TC-INT-001 |
| P1 | 题型覆盖测试 | TC-EXG-002 ~ TC-EXG-005 |
| P2 | 判题逻辑测试 | TC-GRF-002 ~ TC-GRF-008 |
| P3 | 边界与降级测试 | TC-FD-001 ~ TC-FD-005、TC-INT-002 ~ TC-INT-004 |
