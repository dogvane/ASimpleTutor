# 数据模型与存储策略（MVP）- 测试需求文档

## 1. 测试范围概述

本文档针对「数据模型与存储策略」模块进行单元测试设计，涵盖以下数据模型：

- 书籍中心模型（BookHub、ActiveBookHub）
- 文档模型（Document、Section）
- 知识点模型（KnowledgePoint）
- 知识系统模型（KnowledgeSystem、KnowledgeTreeNode）
- 学习内容模型（LearningPack、Summary、ContentLevel）
- 习题模型（Exercise、ExerciseType、ExerciseFeedback）
- 枚举类型转换器（ExerciseTypeConverter）

---

## 2. 测试数据类型

### 2.1 基础模型测试数据

| 模型类型 | 用途 | 预期内容特征 |
|----------|------|--------------|
| BookHub | 书籍中心配置 | 包含 Id、Name、Path、ReferenceDirNames 等字段 |
| Document | 主书内容文档 | 包含 DocId、Path、Title、Sections 等字段 |
| Section | 文档章节 | 包含 SectionId、HeadingPath、StartLine、EndLine 等字段 |
| KnowledgePoint | 知识点 | 包含 KpId、Title、ChapterPath、Importance、DocId |
| KnowledgeSystem | 知识系统容器 | 包含 BookHubId、KnowledgePoints、Documents、Tree |
| LearningPack | 学习内容包 | 包含 KpId、Summary、Levels、RelatedKpIds |
| Exercise | 练习题 | 包含 ExerciseId、Type、Question、CorrectAnswer 等 |

### 2.2 枚举类型测试数据

| 枚举类型 | 测试值 |
|----------|--------|
| RelationType | Prerequisite、Comparison、Contains、Related |
| ExerciseType | SingleChoice、FillBlank、ShortAnswer |

---

## 3. 测试用例

### 3.1 书籍中心模型测试（BookHub）

#### TC-BR-001: BookHub 基础创建

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建 BookHub 实例，设置 Id、Name、Path |
| 预期输出 | 对象字段正确初始化 |
| 验证点 | Id、Name、Path 属性正确设置 |

#### TC-BR-002: BookHub 默认值验证

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建 BookHub 实例，不设置可选字段 |
| 预期输出 | 可选字段使用默认值 |
| 验证点 | Enabled=true, ReferenceDirNames 包含默认值 |

#### TC-BR-003: ActiveBookHub 创建

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建 ActiveBookHub 实例，设置 ActiveBookHubId |
| 预期输出 | ActiveBookHubId 属性正确设置 |
| 验证点 | 可为 null（未激活状态） |

---

### 3.2 文档模型测试（Document/Section）

#### TC-DOC-001: Document 基础创建

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建 Document 实例，设置 DocId、Path、Title |
| 预期输出 | 对象字段正确初始化 |
| 验证点 | Sections 列表初始化为空 |

#### TC-DOC-002: Section 层级路径

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建 Section，设置 HeadingPath |
| 预期输出 | HeadingPath 正确存储层级 |
| 验证点 | 路径可包含多层标题 |

---

### 3.3 文档章节模型测试（Section）

#### TC-SEC-001: Section 基础创建

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建 Section 实例 |
| 预期输出 | 所有字段正确初始化 |
| 验证点 | SectionId、HeadingPath、StartLine、EndLine 正确 |

#### TC-SEC-002: Section 文件追溯

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 设置 HeadingPath、StartLine、EndLine |
| 预期输出 | 可完整追溯原文位置 |
| 验证点 | 路径和行号信息完整保留 |

#### TC-SEC-003: Section 原文引用字段

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 设置 SectionId、HeadingPath |
| 预期输出 | 原文引用字段正确存储 |
| 验证点 | 各字段可正确序列化和反序列化 |

---

### 3.4 知识点模型测试（KnowledgePoint）

#### TC-KP-001: KnowledgePoint 基础创建

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建 KnowledgePoint，设置 KpId、Title |
| 预期输出 | 对象字段正确初始化 |
| 验证点 | Aliases、Relations 初始化为空列表 |

#### TC-KP-002: KnowledgePoint 重要性评分

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 设置 Importance 为 0.0~1.0 之间的值 |
| 预期输出 | 正确存储评分 |
| 验证点 | 浮点数精度正确保留 |

#### TC-KP-003: KnowledgePoint 章节路径

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 设置 ChapterPath 包含多层路径 |
| 预期输出 | 章节路径正确存储 |
| 验证点 | 路径顺序正确 |

#### TC-KP-004: KnowledgePoint 文档关联

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 设置 DocId、BookHubId |
| 预期输出 | 文档关联正确存储 |
| 验证点 | 可正确关联到对应的 Document |

---

### 3.5 知识系统模型测试（KnowledgeSystem/KnowledgeTreeNode）

#### TC-KS-001: KnowledgeSystem 基础创建

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建 KnowledgeSystem 实例 |
| 预期输出 | 对象字段正确初始化 |
| 验证点 | KnowledgePoints、Documents 初始化为空 |

#### TC-KS-002: KnowledgeSystem 文档列表

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 向 Documents 列表添加 Document |
| 预期输出 | 列表正确存储 |
| 验证点 | 可通过 DocId 检索 |

#### TC-KS-003: KnowledgeTreeNode 基础创建

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建 KnowledgeTreeNode |
| 预期输出 | 对象字段正确初始化 |
| 验证点 | Children 初始化为空列表 |

#### TC-KS-004: KnowledgeTreeNode 层级结构

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 构建多层级 KnowledgeTreeNode 树 |
| 预期输出 | 树结构正确构建 |
| 验证点 | 父子关系正确，HeadingPath 正确传递 |

#### TC-KS-005: KnowledgeTreeNode 与 KnowledgePoint 关联

| 项目 | 内容 |
|------|------|
| 前置条件 | 已存在 KnowledgePoint |
| 输入 | 设置 KnowledgePoint 属性 |
| 预期输出 | 节点正确关联知识点 |
| 验证点 | KnowledgePoint 可为 null（非叶子节点） |

---

### 3.6 学习内容模型测试（LearningPack）

#### TC-LP-001: LearningPack 基础创建

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建 LearningPack 实例 |
| 预期输出 | 对象字段正确初始化 |
| 验证点 | Summary、Levels 正确初始化 |

#### TC-LP-002: Summary 定义与要点

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 设置 Summary.Definition、KeyPoints |
| 预期输出 | 精要速览正确存储 |
| 验证点 | Definition 为字符串，KeyPoints 为列表 |

#### TC-LP-003: ContentLevel 层级内容

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建 ContentLevel，设置 Level、Title、Content |
| 预期输出 | 层级内容正确存储 |
| 验证点 | Level 值（1/2/3）正确 |

#### TC-LP-004: LearningPack 关联知识点

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 设置 RelatedKpIds |
| 预期输出 | 关联知识点正确存储 |
| 验证点 | 列表正确序列化 |

---

### 3.7 习题模型测试（Exercise）

#### TC-EX-001: Exercise 基础创建

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建 Exercise 实例 |
| 预期输出 | 对象字段正确初始化 |
| 验证点 | Options、KeyPoints 初始化为空 |

#### TC-EX-002: ExerciseType 英文枚举值

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 设置 Type 为 SingleChoice、FillBlank、ShortAnswer |
| 预期输出 | 正确解析为枚举 |
| 验证点 | 英文枚举值可正确序列化 |

#### TC-EX-003: ExerciseType 中文枚举值解析

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | JSON 反序列化 "选择题"、"填空题"、"简答题" |
| 预期输出 | 正确映射到对应枚举 |
| 验证点 | 中文类型名可正确转换为英文枚举 |

#### TC-EX-004: ExerciseType 多别名解析

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 解析 "单选"、"填空"、"简答" 等别名 |
| 预期输出 | 正确映射到对应枚举 |
| 验证点 | 各别名均可正确映射 |

#### TC-EX-005: Exercise 选择题结构

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建选择题，设置 Options、CorrectAnswer |
| 预期输出 | 选择题结构正确 |
| 验证点 | Options 包含多个选项，CorrectAnswer 正确标记 |

#### TC-EX-006: Exercise 填空题结构

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建填空题，Options 为空 |
| 预期输出 | 填空题结构正确 |
| 验证点 | Options 为空列表，正确答案在 CorrectAnswer |

#### TC-EX-007: Exercise 简答题结构

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建简答题 |
| 预期输出 | 简答题结构正确 |
| 验证点 | KeyPoints 包含参考要点 |

#### TC-EX-008: ExerciseFeedback 反馈结构

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 创建 ExerciseFeedback 实例 |
| 预期输出 | 反馈结构正确 |
| 验证点 | IsCorrect 可为 null（填空/简答），包含 Explanation 和 ReferenceAnswer 字段 |

---

### 3.8 枚举转换器测试

#### TC-CONV-001: ExerciseTypeConverter 反序列化

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 反序列化 JSON 字符串包含 "SingleChoice" |
| 预期输出 | 正确解析为 ExerciseType.SingleChoice |
| 验证点 | 枚举值正确映射 |

#### TC-CONV-002: ExerciseTypeConverter 反序列化中文

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 反序列化 JSON 字符串包含 "选择题" |
| 预期输出 | 正确解析为 ExerciseType.SingleChoice |
| 验证点 | 中文值可正确映射 |

#### TC-CONV-003: ExerciseTypeConverter 序列化

| 项目 | 内容 |
|------|------|
| 前置条件 | 已设置 ExerciseType 枚举值 |
| 输入 | 序列化为 JSON |
| 预期输出 | 英文枚举名输出 |
| 验证点 | 输出为 "SingleChoice" 而非数字 |

#### TC-CONV-004: ExerciseTypeConverter 未知值处理

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 反序列化未知类型值 |
| 预期输出 | 返回默认值 SingleChoice |
| 验证点 | 异常情况有默认值保护 |

#### TC-CONV-005: ExerciseTypeConverter 大小写不敏感

| 项目 | 内容 |
|------|------|
| 前置条件 | 无 |
| 输入 | 反序列化 "singlechoice"、"SINGLECHOICE" |
| 预期输出 | 正确解析为 ExerciseType.SingleChoice |
| 验证点 | 大小写不敏感匹配 |

---

### 3.9 JSON 序列化测试

#### TC-JSON-001: Exercise 完整序列化

| 项目 | 内容 |
|------|------|
| 前置条件 | Exercise 对象已正确填充 |
| 输入 | 序列化为 JSON 字符串 |
| 预期输出 | JSON 格式正确 |
| 验证点 | 包含所有必要字段，枚举值为字符串 |

#### TC-JSON-002: Exercise 完整反序列化

| 项目 | 内容 |
|------|------|
| 前置条件 | JSON 字符串符合预期格式 |
| 输入 | 反序列化为 Exercise 对象 |
| 预期输出 | 对象字段正确恢复 |
| 验证点 | 枚举类型正确转换，列表正确恢复 |

#### TC-JSON-003: KnowledgeSystem 序列化

| 项目 | 内容 |
|------|------|
| 前置条件 | KnowledgeSystem 已构建 |
| 输入 | 序列化为 JSON |
| 预期输出 | JSON 包含 BookHubId、KnowledgePoints、Snippets、Tree |
| 验证点 | 树结构正确序列化 |

#### TC-JSON-004: KnowledgeSystem 反序列化

| 项目 | 内容 |
|------|------|
| 前置条件 | KnowledgeSystem JSON 字符串 |
| 输入 | 反序列化为 KnowledgeSystem 对象 |
| 预期输出 | 对象正确恢复 |
| 验证点 | 字典和列表正确恢复 |

#### TC-JSON-005: 空值处理

| 项目 | 内容 |
|------|------|
| 前置条件 | 可选字段为 null 或空集合 |
| 输入 | 序列化包含 null/空值的对象 |
| 预期输出 | JSON 正确处理空值 |
| 验证点 | 不抛出异常，正确输出 null 或空数组 |

---

## 4. 测试数据文件命名规范

所有测试用数据文件应统一放置于：

```
/test_data/models/
├── bookroot/                     # 书籍目录测试数据
│   ├── basic_bookroot.json
│   └── active_bookroot.json
├── document/                     # 文档测试数据
│   ├── basic_document.json
│   └── nested_sections.json
├── knowledge_point/              # 知识点测试数据
│   ├── basic_kp.json
│   └── kp_with_relations.json
├── knowledge_system/             # 知识系统测试数据
│   ├── empty_system.json
│   └── populated_system.json
├── learning_pack/                # 学习内容测试数据
│   ├── basic_pack.json
│   └── pack_with_levels.json
├── exercise/                     # 习题测试数据
│   ├── choice_exercise.json
│   ├── fillblank_exercise.json
│   ├── shortanswer_exercise.json
│   └── feedback.json
└── json_serialization/           # JSON 序列化测试数据
    ├── exercise_with_chinese_type.json
    └── exercise_with_aliases.json
```

---

## 5. 测试执行优先级

| 优先级 | 测试类型 | 说明 |
|--------|----------|------|
| P0 | 核心模型测试 | TC-DOC-001~004, TC-SS-001~002, TC-KP-001~003 |
| P1 | 枚举与转换器测试 | TC-EX-002~004, TC-CONV-001~005 |
| P2 | 知识系统测试 | TC-KS-001~005 |
| P3 | 学习内容测试 | TC-LP-001~004 |
| P4 | JSON 序列化测试 | TC-JSON-001~005 |
