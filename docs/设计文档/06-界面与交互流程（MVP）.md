# 界面与交互流程（MVP）

## 1. 页面布局

```text
┌─────────────────────────────────────────────────────────────┐
│ 顶部栏 [书籍选择▼] [当前路径: 第3章 > 核心概念] [🔄重扫] [🔍搜索...]        │
├──────────────┬──────────────────────────────────────────────┤
│  章节列表    │  学习面板                                    │
│              │  ┌────────────────────────────────────────┐ │
│  ├─第1章    │  │ 章节: 第3章 核心概念                     │ │
│  ├─第2章    │  │ [KP: 概念定义] [KP: 应用场景] [KP: 注意事项] [▼]│ │
│  ├─第3章 ←──┤  │                                        │ │
│  ├─第4章    │  │                                        │ │
│  └─第5章    │  └────────────────────────────────────────┘ │
└──────────────┴──────────────────────────────────────────────┘

点击 KP（如"概念定义"）后展开学习内容：
┌─────────────────────────────────────────────────────────────┐
│ ...                                                          │
│  │ [KP: 概念定义 ▼] [KP: 应用场景] [KP: 注意事项]           │
│  │ ┌─────────────────────────────────────────────────────┐ │
│  │ │ 精要速览: ...                                        │ │
│  │ │ [原文对照] [层次展开]                                 │ │
│  │ └─────────────────────────────────────────────────────┘ │
│  │                    [习题]                                │
└─────────────────────────────────────────────────────────────┘
```

## 2. 区域定义

### 2.1 顶部栏

| 元素 | 行为 |
|------|------|
| 书籍选择下拉框 | 点击展开 `BookRoot[]` 列表，单击切换；切换时清空状态、触发扫描 |
| 当前路径展示 | 显示当前选中知识点的层级路径（如 `第3章 > 3.2 核心概念 > 定义`），不可编辑 |
| 重新扫描按钮 | 点击后触发目录重新扫描与知识体系重建 |
| 搜索框 | 实时过滤章节列表，支持键盘导航（↓/↑/Enter） |

### 2.2 左侧：章节列表

仅展示书籍章节层级，不展示知识点。

| 功能 | 说明 |
|------|------|
| 章节树视图 | 按书籍章节层级展示，支持折叠/展开 |
| 搜索过滤 | 输入关键词后即时筛选章节，匹配高亮 |
| 选中状态 | 点击某章节，右侧学习面板展示该章节下的知识点列表 |

### 2.3 右侧：学习面板

点击章节后展示该章节的知识点横向列表。

| 元素 | 说明 |
|------|------|
| 章节标题 | 显示当前选中章节的标题 |
| 知识点横向列表 | `[KP: 标题]` 横向排列，点击后展开学习内容，选中项箭头变为 `[▼]` |
| 展开内容 | 点击 KP 后在下方展开：精要速览 + `[原文对照]` `[层次展开]` 按钮 |
| 习题入口 | `[习题]` 按钮，展开知识点时在后台检查是否已生成习题，点击后进入习题界面 |

---

## 3. 核心用户流程

### 3.1 系统入口：选择书籍目录（Book Root）

1. 应用启动后从配置读取 `BookRoot[]`
2. 若仅有 1 个可用项：自动设为当前激活并进入扫描
3. 若有多个可用项：默认选中上次使用的 `active_book_root_id`（或第一个），用户可下拉切换

切换 Book Root 行为：

- 立即触发重新扫描/重建知识体系（或提示确认后执行）
- UI 清空旧知识点与学习内容，进入 loading 状态

### 3.2 启动与扫描

1. 应用启动
2. 自动扫描目录并构建知识体系
3. UI 展示知识点列表

异常：扫描失败时提示错误并允许重试/选择目录。

### 3.3 选择知识点学习

1. 用户点击某 KP
2. 展示：
   - 精要速览（默认）
   - 原文对照（可切换）
   - 层次化展开（按钮逐层展开）
3. 可选：关联拓展列表

### 3.4 习题入口

1. 用户点击某 KP 展开学习内容
2. 后台自动检查该 KP 是否已生成习题，若无则异步生成
3. 展开区域显示 `[习题]` 按钮
4. 点击 `[习题]` 进入习题界面：
   - 有习题：展示 1~3 题，用户作答后提交
   - 无习题：空状态提示

### 3.5 习题反馈

1. 用户提交答案后
2. 展示反馈：正确性 + 讲解 + 参考答案/要点

### 3.6 状态流转图

```text
┌─────────┐
│  启动   │──────────┐
└────┬────┘          │
     ↓               ↓
┌─────────────────────────┐
│  选择书籍（单/多）       │
└─────────┬───────────────┘
          ↓
┌─────────────────────────┐
│  扫描中（loading）       │
└─────────┬───────────────┘
          ↓
    ┌─────┴─────┐
    ↓           ↓
 扫描成功    扫描失败
    ↓           ↓
┌───────────┐  ┌──────────────┐
│ 展示列表  │  │ 错误提示+重试 │
└─────┬─────┘  └───────┬──────┘
      │                └────→ 扫描中
      ↓（点击 KP）
┌─────────────────────────┐
│  学习内容（loading）     │
└─────────┬───────────────┘
          ↓
┌─────────────────────────┐
│  内容展示                │
│  └─ 练习（loading）      │
└─────────────────────────┘
          ↓（点击生成练习）
┌─────────────────────────┐
│  题目展示                │
└─────────┬───────────────┘
          ↓（提交答案）
┌─────────────────────────┐
│  反馈展示                │
└─────────────────────────┘
```

## 4. 交互细节（MVP 关键）

| 场景 | 处理 |
|------|------|
| 原文对照 | 必须包含 `文件名 + 标题路径 + 行号范围` |
| 生成类操作 | 显示 loading 状态，支持取消（可选） |
| Agent 不确定输出 | 用「可能/推测」提示，允许回到原文校验 |
| 加载失败 | 显示错误信息，提供重试按钮 |

## 5. 可访问性

- **键盘导航**：搜索框支持 ↓/↑ 在列表中移动，Enter 选中
- **复制支持**：文本区域支持右键复制 / Ctrl+C
- **焦点管理**：切换 Tab 时焦点移动到对应内容区

## 6. 错误处理规范

| 错误类型 | 用户提示 | 后续操作 |
|----------|----------|----------|
| 扫描无 .md 文件 | 「未找到 Markdown 文件，请确认目录」 | 重试 / 切换目录 |
| 文件解析失败 | 「部分文件解析失败」 | 显示失败列表，重试扫描 |
| 学习内容生成失败 | 「生成失败，请稍后重试」 | 重试按钮 |
| 网络/LLM 错误 | 「服务暂时不可用，请检查网络」 | 重试 / 稍后重试 |

## 7. 相关文档

- [00-总体设计.md](00-总体设计.md)
- [02-知识点浏览与搜索.md](02-知识点浏览与搜索.md)
- [03-学习内容生成（精要速览-原文对照-层次化展开）.md](03-学习内容生成（精要速览-原文对照-层次化展开）.md)
- [04-习题生成与练习反馈.md](04-习题生成与练习反馈.md)

