# 数据结构文档

本文档描述系统中使用的核心数据结构。

> 相关文档：[需求文档](./需求文档.md)

## 目录

- [知识系统](#知识系统)
- [文档结构](#文档结构)
- [知识点](#知识点)
- [知识图谱](#知识图谱)
- [习题系统](#习题系统)
- [学习进度](#学习进度)
- [幻灯片教学](#幻灯片教学)
- [配置](#配置)

---

## 知识系统

### KnowledgeSystem

知识系统根对象，包含完整的知识体系、文档、知识点树和知识图谱。

```csharp
public class KnowledgeSystem
{
    string BookHubId              // 书籍中心 ID
    List<Document> Documents      // 文档列表
    List<KnowledgePoint> KnowledgePoints  // 知识点列表
    KnowledgeTreeNode? Tree       // 知识树（按章节路径组织）
    KnowledgeGraph? Graph         // 知识图谱（语义关系）
}
```

### KnowledgeTreeNode

知识树节点，用于树形展示知识点层级关系。

```csharp
public class KnowledgeTreeNode
{
    string Id                      // 节点唯一标识符
    string Title                   // 节点标题
    List<string> HeadingPath       // 标题路径（完整章节路径）
    string FilePath                // 文档文件路径
    KnowledgePoint? KnowledgePoint // 关联的知识点（叶子节点有）
    List<KnowledgeTreeNode> Children  // 子节点列表
}
```

---

## 文档结构

### Document

表示扫描后的 Markdown 文档，包含章节树结构。

```csharp
public class Document
{
    string DocId           // 文档唯一标识符
    string BookHubId       // 书籍中心 ID
    string Path            // 文档的本地文件系统完整路径
    string Title           // 文档标题（通常从 H1 标题提取）
    List<Section> Sections // 文档章节列表
    string? ContentHash    // 文档内容的 SHA256 哈希值，用于检测变更
}
```

### Section

文档章节，递归结构，支持多层嵌套。

```csharp
public class Section
{
    string SectionId           // 章节唯一标识符
    List<string> HeadingPath   // 标题路径（从根到当前章节的层级路径）
    List<Section> SubSections  // 子章节列表（层级结构）
    int StartLine              // 章节开始的行号（包含标题行）
    int EndLine                // 章节结束的行号（不包含）
    int OriginalLength         // 原始字符数（包含所有内容）
    int EffectiveLength        // 有效字符数（过滤代码块和HTML标签后）
    int FilteredLength         // 过滤掉的字符数
    bool IsExcluded            // 是否被排除（不参与后续处理）
}
```

---

## 知识点

### KnowledgePoint

知识点是系统的核心对象，包含预生成的学习内容。

```csharp
public class KnowledgePoint
{
    string KpId                          // 知识点唯一标识符
    string BookHubId                     // 书籍中心 ID
    string Title                         // 知识点标题（概念名称或术语）
    KpType Type                          // 知识点类型（Concept/Chapter/Process/Api/BestPractice）
    List<string> Aliases                 // 别名列表（用于搜索匹配）
    List<string> ChapterPath             // 所属章节路径
    float Importance                     // 重要性评分（0.0~1.0）
    Summary? Summary                     // 预生成的精要速览
    List<ContentLevel> Levels            // 预生成的层次化内容（L1/L2/L3）
    List<SlideCard> SlideCards           // 预生成的幻灯片卡片列表
    string? DocId                        // 来源文档 ID
    string SectionId                     // 章节 ID
    DateTime CreatedAt                   // 创建时间
    DateTime UpdatedAt                   // 更新时间
}
```

### KpType (枚举)

知识点类型。

```csharp
public enum KpType
{
    Concept,       // 概念（定义、术语、理论）
    Chapter,       // 章节（目录节点）
    Process,       // 流程（步骤、操作流程）
    Api,           // API/接口
    BestPractice   // 最佳实践
}
```

### Summary

精要速览，知识点快速概览内容。

```csharp
public class Summary
{
    string Definition           // 定义（1~3句简明定义）
    List<string> KeyPoints      // 核心要点列表（3~7条）
    List<string> Pitfalls       // 常见误区列表（1~3条）
}
```

### ContentLevel

层次化内容，支持 L1（概览）/L2（详细）/L3（深入）三层。

```csharp
public class ContentLevel
{
    int Level        // 层级：1=概览, 2=详细, 3=深入
    string Title     // 层级标题
    string Content   // 层级内容
}
```

---

## 知识图谱

### KnowledgeGraph

知识图谱，包含节点和边，用于可视化知识点间的语义关系。

```csharp
public class KnowledgeGraph
{
    string GraphId                      // 知识图谱唯一标识符
    string BookHubId                    // 书籍中心 ID
    List<KnowledgeGraphNode> Nodes      // 知识图谱节点列表
    List<KnowledgeGraphEdge> Edges      // 知识图谱边（关系）列表
    DateTime CreatedAt                  // 创建时间
    DateTime UpdatedAt                  // 更新时间
}
```

### KnowledgeGraphNode

知识图谱节点。

```csharp
public class KnowledgeGraphNode
{
    string NodeId                           // 节点唯一标识符（与知识点 ID 相同）
    string Title                            // 节点标题（知识点标题）
    KpType Type                             // 节点类型
    float Importance                        // 重要性评分（0.0~1.0）
    List<string> ChapterPath                // 所属章节路径
    KnowledgeGraphNodeMetadata? Metadata    // 节点元数据（用于可视化）
    KnowledgePoint? KnowledgePoint          // 关联的知识点
}
```

### KnowledgeGraphEdge

知识图谱边（关系）。

```csharp
public class KnowledgeGraphEdge
{
    string EdgeId                    // 边唯一标识符
    string SourceNodeId              // 源节点 ID
    string TargetNodeId              // 目标节点 ID
    KnowledgeGraphEdgeType Type      // 关系类型
    float Weight                     // 关系权重（0.0~1.0）
    string? Description              // 关系描述
}
```

### KnowledgeGraphEdgeType (枚举)

```csharp
public enum KnowledgeGraphEdgeType
{
    Related,      // 相关关系
    DependsOn,    // 依赖关系（源节点依赖目标节点）
    Contains,     // 包含关系（源节点包含目标节点）
    Contrast,     // 对比关系
    ExampleOf,    // 示例关系（源节点是目标节点的示例）
    Extends,      // 扩展关系（源节点扩展目标节点）
    Implements    // 实现关系（源节点实现目标节点）
}
```

---

## 习题系统

### Exercise

练习题。

```csharp
public class Exercise
{
    string ExerciseId                   // 习题唯一标识符
    string KpId                         // 关联的知识点 ID
    ExerciseType Type                   // 习题类型
    int Difficulty                      // 难度等级（1-5，1最简单，5最难）
    string Question                     // 题目内容
    List<string> Options                // 选项列表（选择题、判断题使用）
    string CorrectAnswer                // 正确答案
    string? Explanation                 // 答案解释
    List<string> EvidenceSnippetIds     // 证据原文片段 ID 列表
    List<string> KeyPoints              // 考查要点列表
    DateTime CreatedAt                  // 创建时间
}
```

### ExerciseType (枚举)

```csharp
public enum ExerciseType
{
    SingleChoice,   // 单选题
    MultiChoice,    // 多选题
    TrueFalse,      // 判断题
    ShortAnswer     // 简答题
}
```

### ExerciseFeedback

练习反馈。

```csharp
public class ExerciseFeedback
{
    bool? IsCorrect                 // 是否正确
    string Explanation              // 解释说明
    string? ReferenceAnswer         // 参考答案
}
```

### ExerciseSubmission

答题请求。

```csharp
public class ExerciseSubmission
{
    string ExerciseId        // 习题 ID
    string Answer            // 用户答案
    int? TimeSpentSeconds    // 花费时间（秒）
}
```

---

## 学习进度

### UserProgress

用户学习进度。

```csharp
public class UserProgress
{
    string UserId                // 用户标识（当前为单用户，固定为 "default"）
    string KpId                  // 知识点 ID
    LearningStatus Status        // 学习状态
    float MasteryLevel           // 掌握度（0.0 ~ 1.0）
    List<string> CompletedSlideIds  // 已完成的幻灯片卡片 ID 列表
    DateTime? LastReviewTime     // 最后学习时间
    int ReviewCount              // 学习次数
    int TotalDurationSeconds     // 总学习时长（秒）
}
```

### LearningStatus (枚举)

```csharp
public enum LearningStatus
{
    Todo,       // 未开始
    Learning,   // 学习中
    Mastered    // 已掌握
}
```

### MistakeRecord

错题记录。

```csharp
public class MistakeRecord
{
    string RecordId          // 记录唯一标识符
    string UserId            // 用户标识
    string ExerciseId        // 关联的习题 ID
    string KpId              // 关联的知识点 ID
    string UserAnswer        // 用户答案
    string CorrectAnswer     // 正确答案
    DateTime CreatedAt       // 创建时间
    bool IsResolved          // 是否已解决
    DateTime? ResolvedAt     // 解决时间
    int ErrorCount           // 错误次数
}
```

---

## 幻灯片教学

### SlideCard

幻灯片卡片，用于 PPT 教学模式。

```csharp
public class SlideCard
{
    string SlideId                    // 卡片唯一标识符
    string KpId                       // 所属知识点 ID
    SlideType Type                    // 卡片类型
    int Order                         // 卡片序号（用于排序）
    string AudioUrl                   // 音频文件路径（如果设置过）
    string Title                      // 卡片标题
    string HtmlContent                // HTML 内容
    string? SpeechScript              // 口语化讲解脚本（用于 TTS）
}
```

### SlideType (枚举)

```csharp
public enum SlideType
{
    Cover,       // 封面/导言（Glance 概览）
    Explanation, // 概念解释（Detail 详细）
    Example,     // 示例/案例分析
    DeepDive,    // 深入探讨（Deep 深入，可选）
    Quiz,        // 随堂测验（Quiz）
    Source,      // 原文对照
    Relations,   // 知识关联
    Summary      // 总结回顾
}
```

### LearningPack

学习内容包。

```csharp
public class LearningPack
{
    string KpId                      // 所属知识点 ID
    Summary Summary                  // 精要速览（定义、要点、常见误区）
    List<ContentLevel> Levels        // 层次化内容列表（L1/L2/L3）
    List<string> RelatedKpIds        // 关联知识点 ID 列表
    List<SlideCard> SlideCards       // 预生成的幻灯片卡片列表
}
```

---

## 配置

### BookHub

书籍中心配置。

```csharp
public class BookHub
{
    string Id                    // 书籍中心唯一标识符
    string Name                  // 书籍中心显示名称
    string Path                  // 书籍中心的本地文件系统路径
    List<string> ReferenceDirNames  // 参考书目目录名称列表，扫描时将排除
    List<string> ExcludeGlobs    // 排除的文件 glob 模式列表
    bool Enabled                 // 是否启用该书籍中心
    int Order                    // 显示顺序（数值越小越靠前）
}
```

### ActiveBookHub

当前激活的书籍中心。

```csharp
public class ActiveBookHub
{
    string? ActiveBookHubId  // 当前激活的书籍中心 ID
}
```
