# 总体设计（MVP）

## 1. 目标与范围

### 1.1 目标

构建一个“基于书籍 Markdown 文档”的智能学习系统（最小 MVP）：

- 启动时扫描指定目录的 `.md` 文档
- 通过 Agent 建立知识体系与知识点
- 用户选择知识点后，生成学习内容（精要速览/原文对照/层次化展开）
- 可选：展示关联知识点
- 可选：生成 1~3 道小题并提供练习反馈

### 1.2 MVP 明确不做

- 完整的多本书/多项目管理能力（新增/删除/重命名/分组/权限等）
- 学习闭环：学习进度、错题本、学习报告、章节回顾、章节考核/闯关

> 重要补充：**书籍目录（Book Root）作为输入项需要从一开始纳入系统设计**。项目内允许在配置中声明多个书籍目录，为未来扩展做铺垫；但 MVP 阶段仅要求“能从配置里选定一个当前激活的书籍目录并进入学习”。

## 2. 核心概念（术语表）

- **书籍目录（Book Root）**：一个原始目录路径，作为书籍内容输入源（包含若干 `.md` 文档）。项目允许配置多个 Book Root，但任一时刻只有一个处于“当前激活”。
- **文档（Document）**：书籍目录下的一个 `.md` 文件。
- **参考书目目录（Reference Library, 可选）**：Book Root 下的一个子目录（同样包含 `.md`），保存与当前书籍相关的“参考树/参考资料”。
  - MVP 阶段：**不参与知识体系构建扫描**，也**不录入 RAG 索引**。
  - 后续深度探索：在“知识点深入理解/扩展学习”时，允许对参考书目目录做检索与引用。
- **知识点（Knowledge Point, KP）**：可学习的最小概念单元。
- **知识体系（Knowledge Graph/Tree）**：KPs 的层级结构 + 关联关系（树为主，图为辅）。
- **原文片段（Source Snippet）**：与某知识点相关的 Markdown 段落（保留出处信息）。
- **学习内容（Learning Pack）**：围绕知识点生成的结构化内容：精要速览、层次化内容等。
- **练习题（Exercise）**：围绕知识点生成的 1~3 道题。

## 3. 高层架构

### 3.1 组件划分

- **扫描器（Scanner）**：遍历目录、读取 `.md` 文档、基础分段。
- **知识构建 Agent（Knowledge Builder Agent）**：从文档中提取候选知识点、层级、关联、证据片段。
- **检索/映射（Retriever/Mapper）**：从知识点定位相关原文片段。
- **内容生成 Agent（Content Agent）**：生成精要速览、分层展开内容。
- **习题生成/评阅 Agent（Exercise Agent）**：出题与判题/讲解。
- **UI/交互层（UI）**：知识点列表、搜索、学习面板、练习面板。
- **存储层（Store）**：MVP 可先用内存 + 可选落盘缓存（见 05）。

### 3.2 数据流（端到端）

0. 入口：从配置读取可用的 Book Root 列表，确定当前激活的 Book Root（默认值/用户选择）
1. 启动/刷新：Scanner 读取“当前激活 Book Root”内的文档 → Knowledge Builder Agent 产出知识体系（树/图）+ 每个 KP 的证据片段引用
2. 浏览：UI 展示知识点列表（按章节/重要性）
3. 学习：用户选择 KP → Retriever 找原文片段 → Content Agent 生成学习内容
4. 练习（可选）：Exercise Agent 生成题目 → 用户作答 → Agent 给出反馈/参考答案

## 4. 关键设计决策（MVP）

- **单激活 Book Root**：配置可包含多个 Book Root，但系统任一时刻仅对一个 Book Root 构建与展示知识体系；切换 Book Root 视为“切换学习上下文”，会触发重建/重新加载。
- **知识体系结构**：主结构用“树”（章节/小节 → KP），辅以关联边。
- **可解释性优先**：每个 KP 至少关联 1 个原文证据片段（用于“原文对照”）。
- **生成内容结构化**：Agent 输出尽量用 JSON/Schema 约束，UI 展示再格式化。

## 5. API/接口边界（抽象）

> 具体字段见 05；此处定义模块间调用形态。

- `scan_book(root_path) -> List[Document]`
- `build_knowledge(docs) -> KnowledgeSystem`
- `list_knowledge_points(ks, filters) -> List[KP]`
- `search_knowledge_points(ks, query) -> List[KP]`
- `get_learning_pack(ks, kp_id) -> LearningPack`
- `generate_exercises(kp_id, n=1..3) -> List[Exercise]`
- `grade_answer(exercise, user_answer) -> ExerciseFeedback`

## 6. 失败与降级策略

- 无法解析/读取某些文档：记录并跳过，UI 展示“部分文档不可用”。
- Agent 生成失败：
  - 知识体系：允许只生成“按文件/标题的目录树”作为临时知识点。
  - 学习内容：退化为“原文片段 + 简短摘要”。
  - 习题：退化为只给参考答案提示，不做严格判分。

## 7. 安全与合规（MVP）

- 默认仅处理本地书籍目录文本，不上传第三方（如需云模型调用，需在配置与文档中明确告知）。
- 保留原文引用与出处，避免“脱离原文的虚构”。

## 8. 相关文档

- [01-文档扫描与知识体系构建.md](01-文档扫描与知识体系构建.md)
- [02-知识点浏览与搜索.md](02-知识点浏览与搜索.md)
- [03-学习内容生成（精要速览-原文对照-层次化展开）.md](03-学习内容生成（精要速览-原文对照-层次化展开）.md)
- [04-习题生成与练习反馈.md](04-习题生成与练习反馈.md)
- [05-数据模型与存储策略（MVP）.md](05-数据模型与存储策略（MVP）.md)

