# 总体设计

## 1. 目标与范围

### 1.1 目标

构建一个基于书籍 Markdown 文档的**全功能智能学习系统**，旨在帮助用户深度理解技术书籍、内化知识并进行有效评估。

核心能力：

- **多书籍管理**：支持切换不同的学习项目。
- **混合知识体系**：自动化构建“结构树 + 概念图”。
- **RAG 增强学习**：利用向量检索技术，实现跨章节、跨参考资料的知识关联与深度问答。
- **学习闭环**：提供学习进度追踪、错题本、章节回顾与考核功能。
- **Agent 教学**：模拟私人导师，提供分层讲解、出题、判卷和答疑。

## 2. 核心概念（术语表）

- **Book Root（书籍根目录）**：书籍数据源的根路径，包含主文档及参考资料。
- **Reference Library（参考资料库）**：书籍目录下特定的子目录，用于补充 RAG 检索上下文，但不直接生成通过式学习路径。
- **Knowledge Graph（知识图谱）**：由章节结构（Tree）和概念关联（Web）组成的混合知识结构。
- **Source Snippet（原文片段）**：文档中的物理切片，包含文本内容及位置信息（File Path, Line Range）。
- **RAG Index（检索索引）**：基于 Embedding 的向量索引，用于语义检索。
- **Learning Session（学习会话）**：用户的一次学习过程，包含阅读、问答、练习等交互。
- **Mastery Level（掌握度）**：用户对特定知识点的掌握程度评分（0~100%）。

## 3. 高层架构

### 3.1 逻辑分层

- **UI 层**：前端界面（Vue.js/Web），负责交互展示、进度可视化、编辑器集成。
- **API 层**：RESTful API，负责请求路由、用户鉴权（将来）、会话管理。
- **业务逻辑层 (Core)**：
  - **Knowledge Engine**：负责扫描、解析、构建知识图谱。
  - **Learning Engine**：负责内容生成、RAG 检索、上下文组装。
  - **Assessment Engine**：负责出题、判卷、错题管理、能力评估。
- **Agent 编排层 (Semantic Kernel)**：
  - 统一管理 LLM 连接。
  - 编排复杂任务（Planner）。
  - 管理 Plugins (Skills)：`KnowledgePlugin`, `TutorPlugin`, `QuizPlugin`.
- **存储层 (Repository)**：
  - **SQLite**：存储结构化数据（知识点、习题、用户进度）。
  - **Vector DB (Embedded)**：存储文本向量索引（如 SK Memory 或 Qdrant/SQLite-VSS）。

### 3.2 数据流（端到端）

1. **初始化/扫描**：
    - Scanner 遍历目录 → 解析 Markdown → 分块（Chunking）。
    - Embedding Service 生成向量 → 写入 RAG Index。
    - Knowledge Agent 提取概念与关系 → 写入 Knowledge DB。
2. **学习交互**：
    - 用户请求 KP → Learning Engine 查询 DB 获取结构信息。
    - 结合 RAG 检索关联片段 → Prompt 组装。
    - Agent 生成分层内容 → UI 展示。
3. **练习闭环**：
    - Assessment Engine 生成题目 → 用户作答。
    - Agent 判卷并生成反馈 → 更新 Mastery Level → 写入错题本。

## 4. 关键设计决策

- **SQLite + Vector 混合存储**：为了简化部署同时也满足 RAG 需求，优先选用支持向量扩展的 SQLite 方案，或轻量级嵌入式向量库。
- **Semantic Kernel 为核心**：利用 SK 的 Planner 和 Memory 能力，减少手写胶水代码。
- **增量更新**：扫描模块需记录文件 Hash，仅处理变动文件，避免重复消耗 Token 和计算资源。
- **多 Agent 协作**：将任务拆分为不同的角色（提取者、讲师、考官），以便独立优化 Prompt 和能力。

## 5. 模块化设计

系统分为以下核心模块设计文档：

- [01-文档扫描与知识体系构建](01-文档扫描与知识体系构建.md)
- [02-知识点浏览与搜索](02-知识点浏览与搜索.md)
- [03-学习内容生成](03-学习内容生成（精要速览-原文对照-层次化展开）.md)
- [04-习题生成与练习反馈](04-习题生成与练习反馈.md)
- [05-数据模型与存储策略](05-数据模型与存储策略（MVP）.md) (待重命名)
- [06-界面与交互流程](06-界面与交互流程（MVP）.md) (待重命名)
- [07-Agent编排与提示词策略](07-Agent编排与提示词策略（MVP）.md) (待重命名)

## 6. 安全与合规

- **本地优先**：默认使用本地存储。
- **模型可控**：支持配置本地 LLM (如 Ollama) 以实现完全离线运行。
