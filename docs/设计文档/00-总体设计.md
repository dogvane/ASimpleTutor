# 总体设计

## 1. 目标与范围

### 1.1 目标

构建一个基于书籍 Markdown 文档的**智能学习系统**，专注于单本书/单目录的学习体验。

核心能力：

- **单书籍学习**：专注于单本书/单目录的学习体验。
- **预处理阶段**：扫描书籍章节，分片段，数据存储到单独文件。
- **数据生成阶段**：基于扫描结果生成知识点、PPT、TTS描述、知识图谱、知识体系，所有数据与片段关联。
- **学习阶段**：左侧章节树导航，右侧PPT形式学习界面，包含口语教案和习题。

## 2. 核心概念（术语表）

- **Book Hub（书籍中心）**：书籍数据源的根路径，包含主文档。
- **章节树**：基于扫描后的树形结构，包含章节层级和片段。
- **Section（片段）**：将每个章节内容切分的片段，保留位置信息（filePath + 标题路径 + 行号范围）。Section 是处理阶段里所有原文的最小存储片段。
- **知识点（Knowledge Point）**：从片段中提取的核心术语、定义或概念，关联到对应的片段。
- **知识体系**：基于章节树和知识点建立的层次化结构。
- **知识图谱**：将知识点转换为节点，保留其类型、重要性、章节路径等属性，计算节点间的关系权重。
- **幻灯片卡片**：为每个知识点生成的教学卡片，基于章节片段原文、知识点信息和知识图谱，分为多个类型逐个生成。
- **TTS口播说明**：为每个幻灯片页面生成的匹配的口语教案，用于对接TTS（文本转语音）功能，提供音频讲解。

## 3. 高层架构

### 3.1 逻辑分层

- **UI 层**：前端界面（Vue.js/Web），负责交互展示、进度可视化、编辑器集成。
- **API 层**：RESTful API，负责请求路由、用户鉴权（将来）、会话管理。
- **业务逻辑层 (Core)**：
  - **Knowledge Builder**：负责扫描、解析、构建知识系统，提取知识点并生成学习内容。
  - **Learning Generator**：负责为知识点生成结构化学习内容，包含摘要、层次化内容和幻灯片卡片。
  - **Exercise Service**：负责生成习题和提供反馈，包括判题、错题记录和掌握度计算。
  - **Knowledge System Store**：负责知识系统的持久化存储和加载，使用文件系统存储数据。
- **服务层**：
  - **LLM Service**：负责与 LLM 模型交互，提取知识点、生成学习内容和习题。
  - **Scanner Service**：负责扫描和解析 Markdown 文档，生成结构化的文档对象。

### 3.2 数据流（端到端）

1. **预处理阶段**：
    - 扫描指定目录中的 .md 文档，识别文档的标题层级，构建章节树结构。
    - 将每个章节内容切分为片段，保留片段的位置信息（filePath + 标题路径 + 行号范围）。
    - 预处理结果存储为单独的文件，包含章节树、片段及其位置信息。

2. **数据生成阶段**：
    - 基于片段提取知识点，每个知识点关联到对应的片段。
    - 基于章节树和知识点建立层次化的知识体系。
    - 将知识点转换为知识图谱节点，计算节点间的关系权重。
    - 为每个知识点生成教学幻灯片卡片，基于章节片段原文、知识点信息和知识图谱。
    - 为每个PPT页面生成匹配的口播说明，用于对接TTS功能。
    - 所有数据都与片段直接关联。

3. **学习阶段**：
    - 用户从左侧章节树选择章节。
    - 系统在右侧显示该章节的学习界面，以PPT形式呈现。
    - 提供滑动翻页、原文对照、知识关联等交互方式。
    - 用户可点击最后一页PPT右下角的习题按钮进行复习和总结。

## 4. 关键设计决策

- **预处理数据单独存储**：预处理结果存储为单独的文件，包含章节树、片段及其位置信息，方便后续使用。
- **片段关联**：所有数据生成（知识点、PPT、TTS描述、知识图谱、知识体系）都与片段直接关联。
- **口语教案生成**：基于章节片段原文、知识点信息、知识图谱生成合适的口语化教案，分为多个幻灯片卡片逐个生成。
- **TTS集成**：为每个PPT页面生成匹配的口播说明，对接TTS功能，提供音频讲解。
- **习题位置设计**：习题按钮位于最后一页PPT的右下角，点击后展开习题界面，用户可进行复习和总结。
- **章节树导航**：左侧是章节树列表，按照扫描后的树形结构展示，支持点击导航。

## 5. 模块化设计

系统分为以下核心模块设计文档：

- [01-文档扫描与知识体系构建](01-文档扫描与知识体系构建.md)
- [02-知识点浏览与搜索](02-知识点浏览与搜索.md)
- [03-学习内容生成（幻灯片教学卡片）](03-学习内容生成（幻灯片教学卡片）.md)
- [04-习题生成与练习反馈](04-习题生成与练习反馈.md)
- [05-数据模型与存储策略](05-数据模型与存储策略.md)
- [06-界面与交互流程](06-界面与交互流程.md)
- [07-Agent编排与提示词策略](07-Agent编排与提示词策略.md)

## 6. 安全与合规

- **本地优先**：默认使用本地存储。
- **模型可控**：支持配置本地 LLM (如 Ollama) 以实现完全离线运行。
