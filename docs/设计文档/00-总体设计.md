# 总体设计

## 1. 目标与范围

### 1.1 目标

构建一个基于书籍 Markdown 文档的**全功能智能学习系统**，旨在帮助用户深度理解技术书籍、内化知识并进行有效评估。

核心能力：

- **多书籍管理**：支持切换不同的学习项目。
- **混合知识体系**：自动化构建“结构树 + 概念图”。
- **学习闭环**：提供学习内容生成、习题生成、练习反馈等功能。
- **Agent 教学**：模拟私人导师，提供分层讲解、出题、判卷和答疑。

## 2. 核心概念（术语表）

- **Book Hub（书籍中心）**：书籍数据源的根路径，包含主文档及参考资料。
- **Knowledge System（知识系统）**：由知识点、原文片段和知识树组成的知识结构。
- **Knowledge Point（知识点）**：从文档中提取的可学习单元，包含标题、类型、重要性等属性。
- **Source Snippet（原文片段）**：文档中的物理切片，包含文本内容及位置信息（File Path, Line Range）。
- **Learning Pack（学习包）**：为知识点生成的结构化学习内容，包含摘要、层次化内容和幻灯片卡片。
- **Exercise（习题）**：为知识点生成的练习题，包含题目、选项、正确答案等属性。
- **Exercise Feedback（习题反馈）**：对用户习题答案的反馈，包含是否正确、解释、参考答案等属性。

## 3. 高层架构

### 3.1 逻辑分层

- **UI 层**：前端界面（Vue.js/Web），负责交互展示、进度可视化、编辑器集成。
- **API 层**：RESTful API，负责请求路由、用户鉴权（将来）、会话管理。
- **业务逻辑层 (Core)**：
  - **Knowledge Builder**：负责扫描、解析、构建知识系统，提取知识点并生成学习内容。
  - **Learning Generator**：负责为知识点生成结构化学习内容，包含摘要、层次化内容和幻灯片卡片。
  - **Exercise Service**：负责生成习题和提供反馈，包括判题、错题记录和掌握度计算。
  - **Knowledge System Store**：负责知识系统的持久化存储和加载，使用文件系统存储数据。
- **服务层**：
  - **LLM Service**：负责与 LLM 模型交互，提取知识点、生成学习内容和习题。
  - **Scanner Service**：负责扫描和解析 Markdown 文档，生成结构化的文档对象。

### 3.2 数据流（端到端）

1. **初始化/扫描**：
    - MarkdownScanner 扫描目录 → 解析 Markdown → 生成 Document 对象。
    - KnowledgeBuilder 调用 LLMService 提取知识点 → 构建 KnowledgeSystem。
    - 调用方获取 KnowledgeBuilder.BuildAsync 返回的 (KnowledgeSystem, List<Document>) 元组。
    - KnowledgeSystemStore 保存 KnowledgeSystem 到文件系统。
2. **学习交互**：
    - 用户请求 KP → LearningGenerator 从 KnowledgeSystemStore 加载知识系统。
    - 提取相关原文片段 → 调用 LLMService 生成学习内容。
    - 返回 LearningPack 给用户。
3. **练习闭环**：
    - ExerciseService 生成题目 → 用户作答。
    - ExerciseService 判卷并生成反馈 → 更新错题本。
    - 计算掌握度更新。

## 4. 关键设计决策

- **文件系统存储**：使用文件系统存储知识系统数据，简化部署和管理。
- **LLM 驱动**：利用 LLM 能力提取知识点、生成学习内容和习题。
- **分层内容**：为知识点生成层次化的学习内容，满足不同学习阶段的需求。
- **幻灯片卡片**：为知识点生成幻灯片卡片，提供可视化的学习体验。

## 5. 模块化设计

系统分为以下核心模块设计文档：

- [01-文档扫描与知识体系构建](01-文档扫描与知识体系构建.md)
- [02-知识点浏览与搜索](02-知识点浏览与搜索.md)
- [03-学习内容生成（幻灯片教学卡片）](03-学习内容生成（幻灯片教学卡片）.md)
- [04-习题生成与练习反馈](04-习题生成与练习反馈.md)
- [05-数据模型与存储策略](05-数据模型与存储策略.md)
- [06-界面与交互流程](06-界面与交互流程.md)
- [07-Agent编排与提示词策略](07-Agent编排与提示词策略.md)

## 6. 安全与合规

- **本地优先**：默认使用本地存储。
- **模型可控**：支持配置本地 LLM (如 Ollama) 以实现完全离线运行。
