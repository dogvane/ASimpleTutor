# 习题生成与练习反馈

## 1. 考核体系

将评估无缝融入学习流程：
- **Embedded Quiz (随堂测验)**：以 **Quiz Slide** 的形式穿插在 PPT 播放流中，学完即测。
- **Chapter Review (章节考核)**：针对整个章节的综合测试卷（一组连续的 Quiz Slides）。
- **Mistake Review (错题复习)**：针对复习模式生成的专项 Quiz Slide 队列。

## 2. 习题生成策略

### 2.1 题型库
- **选择题 (Single/Multi Choice)**：考核概念辨析。
- **判断题 (True/False)**：快速检验核心观点。
- **填空题 (Fill-in-the-blank)**：考核关键术语记忆（较少使用，因为移动端输入不便）。
- **代码补全/改错 (Code Completion/Debug)**：(针对技术书籍) 提取代码片段挖空或注入错误。

### 2.2 生成流程
1.  **Context 准备**：获取 KP 核心内容 + 原文 + 易错点。
2.  **Agent Prompting**：
    - Role: Examiner (严谨的考官)。
    - Task: 生成符合难度要求的题目，并给出标准答案和解析。
    - Output: 结构化 JSON。
3.  **持久化**：生成的题目存入题库表 `Exercises`。

## 3. 交互与反馈 (Embedded Interaction)

### 3.1 Quiz Slide 展示
- 每一个习题渲染为一个独立的 **Slide Card**。
- **界面**：
    - 上半部分：题目描述（支持代码块、图片）。
    - 下半部分：交互选项区域。
    - 底部：提交按钮（对于单选可能点击选项即提交）。

### 3.2 即时判题
- 用户提交后，**不跳转页面**，直接在当前 Slide 上覆盖显示结果层。
    - **Correct**: 显示绿色对勾 ✅ + “回答正确” + 简短解析。
    - **Incorrect**: 显示红色叉号 ❌ + “回答错误” + 错因分析 + 标准答案。
- **流程控制**：
    - 强制模式：必须答对（或尝试 N 次）才能点击“Next”翻到下一页。
    - 宽松模式：答错也可以继续。

### 3.3 掌握度更新 (Mastery Level)
- 每次 Quiz Slide 交互结束后，后台异步更新相关 knowledge point 的掌握度。

### 3.4 错题本 (Mistake Notebook)
- 用户做错的题目自动进入 `MistakeRecord` 表。
- **消灭错题**：用户在错题本中点击“复习”，系统生成一个包含该题的临时 **Quiz Slide**，用户重做正确后将其标记为已解决。

## 4. 数据结构

### 4.1 Exercise Schema
```json
{
  "id": "uuid",
  "kp_id": "string",
  "type": "choice|code|bool",
  "difficulty": 1-5,
  "content": { "question": "...", "options": [...] },
  "answer": { "correct": "...", "explanation": "..." },
  "slide_config": { "allow_skip": true } 
}
```
*注：Exercise 数据通常被嵌入在 Slide 的 `content_payload` 中，或作为独立引用存在。*

