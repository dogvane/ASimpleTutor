<svg xmlns="http://www.w3.org/2000/svg" width="960" height="400" viewBox="0 0 960 400">
  <style>
    .bg{fill:#fff}
    .node{fill:#fff;stroke:#333;stroke-width:1.5}
    .node-fail{fill:#fff5f5;stroke:#c62828;stroke-width:1.5}
    .text{font-family:Arial,sans-serif;fill:#333;font-size:11px}
    .text-fail{font-family:Arial,sans-serif;fill:#c62828;font-size:10px}
    .arrow{stroke:#666;stroke-width:1.2;fill:none;marker-end:url(#arrow)}
    .arrow-fail{stroke:#c62828;stroke-width:1.2;fill:none;marker-end:url(#arrow-red)}
    .arrow-loop{stroke:#2e7d32;stroke-width:1.2;fill:none;marker-end:url(#arrow-green)}
    .label{font-family:Arial,sans-serif;fill:#888;font-size:10px}
  </style>
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <path d="M0,0 L8,4 L0,8 Z" fill="#666" />
    </marker>
    <marker id="arrow-red" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <path d="M0,0 L8,4 L0,8 Z" fill="#c62828" />
    </marker>
    <marker id="arrow-green" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <path d="M0,0 L8,4 L0,8 Z" fill="#2e7d32" />
    </marker>
  </defs>

  <!-- Background -->
  <rect class="bg" width="960" height="400"/>

  <!-- === Row 1: Main Flow === -->
  <!-- Boot -->
  <rect class="node" x="30" y="60" width="90" height="36" rx="4"/>
  <text class="text" x="75" y="84" text-anchor="middle">Boot</text>

  <!-- SelectBook -->
  <rect class="node" x="150" y="60" width="110" height="36" rx="4"/>
  <text class="text" x="205" y="84" text-anchor="middle">SelectBook</text>

  <!-- Scanning -->
  <rect class="node" x="290" y="60" width="100" height="36" rx="4"/>
  <text class="text" x="340" y="84" text-anchor="middle">Scanning</text>

  <!-- Ready -->
  <rect class="node" x="420" y="60" width="100" height="36" rx="4"/>
  <text class="text" x="470" y="84" text-anchor="middle">Ready</text>

  <!-- ChapterSelected -->
  <rect class="node" x="550" y="60" width="130" height="36" rx="4"/>
  <text class="text" x="615" y="84" text-anchor="middle">ChapterSelected</text>

  <!-- KpLoading -->
  <rect class="node" x="710" y="60" width="100" height="36" rx="4"/>
  <text class="text" x="760" y="84" text-anchor="middle">KpLoading</text>

  <!-- LearningReady -->
  <rect class="node" x="30" y="180" width="120" height="36" rx="4"/>
  <text class="text" x="90" y="204" text-anchor="middle">LearningReady</text>

  <!-- ExercisesGenerating -->
  <rect class="node" x="180" y="180" width="150" height="36" rx="4"/>
  <text class="text" x="255" y="204" text-anchor="middle">ExercisesGenerating</text>

  <!-- ExercisesReady -->
  <rect class="node" x="360" y="180" width="120" height="36" rx="4"/>
  <text class="text" x="420" y="204" text-anchor="middle">ExercisesReady</text>

  <!-- FeedbackReady -->
  <rect class="node" x="510" y="180" width="120" height="36" rx="4"/>
  <text class="text" x="570" y="204" text-anchor="middle">FeedbackReady</text>

  <!-- === Main Flow Arrows === -->
  <line class="arrow" x1="120" y1="78" x2="150" y2="78" />
  <line class="arrow" x1="260" y1="78" x2="290" y2="78" />
  <line class="arrow" x1="390" y1="78" x2="420" y2="78" />
  <line class="arrow" x1="520" y1="78" x2="550" y2="78" />
  <line class="arrow" x1="680" y1="78" x2="710" y2="78" />

  <!-- Single book skip -->
  <path class="arrow-loop" d="M205,60 L205,40 L290,40 L290,60" />
  <text class="text" style="fill:#2e7d32" x="230" y="35" text-anchor="middle">单书跳过</text>

  <!-- Down to Learning -->
  <line class="arrow" x1="760" y1="96" x2="90" y2="180" />

  <!-- Learning flow -->
  <line class="arrow" x1="150" y1="198" x2="180" y2="198" />
  <line class="arrow" x1="330" y1="198" x2="360" y2="198" />
  <line class="arrow" x1="480" y1="198" x2="510" y2="198" />

  <!-- === Loop Arrows === -->
  <!-- Chapter loop -->
  <path class="arrow-loop" d="M615,96 L615,115 L550,115 L550,96" />
  <text class="text" style="fill:#2e7d32" x="568" y="110" text-anchor="middle">切换</text>

  <!-- KP loop -->
  <path class="arrow-loop" d="M760,96 L760,115 L710,115 L710,96" />
  <text class="text" style="fill:#2e7d32" x="720" y="110" text-anchor="middle">切换</text>

  <!-- Feedback→Continue -->
  <path class="arrow-loop" d="M630,180 L630,165 L570,165 L570,180" />
  <text class="text" style="fill:#2e7d32" x="585" y="160" text-anchor="middle">继续</text>

  <!-- Feedback→Learning -->
  <path class="arrow-loop" d="M510,216 L510,250 L160,250 L160,216" />
  <text class="text" x="280" y="245" text-anchor="middle">返回学习</text>

  <!-- === Labels === -->
  <text class="label" x="30" y="360">主流程: Boot → SelectBook → Scanning → Ready → Chapter → Kp → Learning → Exercises → Feedback</text>
  <text class="label" x="30" y="380">绿色: 可切换/返回 | 失败态由模块F统一处理</text>
</svg>
